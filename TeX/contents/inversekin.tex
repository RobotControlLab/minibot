\section{Inverse Kinematics (IK)}
\label{sec:inversekin}

Suppose that we are given a point $H \in \SEthree$: 
\[ \bm{H} = \bmat{\bm{R} & \bm{o} \\ 0 & 1}. \]
We want to find a $\bm{q} \in \mc{Q}$ such that $f(\bm{q}) = \bm{H}$. We
describe two methods to achieve this, which would yield equivalent solutions for
a fully-actuated robot, but the differences get amplified when the robot is
redundant such as miniBot-7R.

We will be using gradient-based optimization to solve for the joint angles. This
is a recursive algorithm that improves on the current guess $\bm{q}^{(k)}$ to
a solution $\bm{q}^d$ by performing the following iteration.
%
\begin{align}
  \begin{split}
  \bar{\bm{q}}^{(k+1)} &= \bm{q}^{(k)} - \alpha_k \bm{M}\left(\bm{q}^{(k)}\right)\delta \bm{x}, \\
  \bm{q}^{(k+1)} &= \operatorname{clamp}\left(\bar{\bm{q}}^{(k+1)}, \bm{q}_{\text{lb}}, \bm{q}_{\text{ub}} \right).
  \end{split}
  \label{eq:gd}
\end{align}
%
The matrix $\bm{M}$ is some sort of Jacobian, $\delta \bm{x}$ is the pertinent 
error that the current guess produces, and $(\bm{q}_{\text{lb}},
\bm{q}_{\text{ub}})$ is the lower and upper bounds on the joint angles.

\subsection{IK by Decoupling Position and Orientation}
\label{ssec:ik_decoupling}

We first consider the inverse position kinematics problem, 
which relies on the fact that the inverse orientation kinematics may be solved
by using the final three joints due to the presence of a spherical wrist.
Indeed, whatever the 
rotation matrix $^0\bm{R}_4$ is, there exist $q_5$, $q_6$ and $q_7$, such that
${}^0\bm{R}_4 {}^4\bm{R}_7 = \bm{R}$. Since ${}^0\bm{R}_4$ will be determined
once the inverse position kinematics problem is solved, one can then use $q_5$
through $q_7$ to yield ${}^4\bm{R}_7 = {}^0\bm{R}_4^\top\bm{R}$ following the 
steps outlined in Chapter 5.4 of~\cite{spong2020robot} (pg. 151).

The inverse position kinematics problem is to find $q_1$ through $q_4$ such
that the product $\prod_1^4 \bm{A}_i$ has as its translation vector the wrist
center location, $\bm{o}_c \in \mathbb{R}^3$.

In order to solve the inverse position problem, we first find the location of
the wrist center $\bm{o}_c$ in the base coordinate system,
$\Sigma_0$: \[ \bm{o}_c = \bm{o} - d_7 \bm{R} \bmat{0 & 0 & 1}^\top. \]
%
The gradient descent optimization in equation~\eqref{eq:gd} is then performed 
with $\delta \bm{x} = \left(f\left(\bm{q}^{(k)}\right) - \bm{o}_c \right)$.
We can take the matrix $\bm{M}$ as the pseudo-inverse or the transpose
of the Jacobian, $\bm{J}_w$, that maps the rates of changes $\dot{q}_1$ through
$\dot{q}_4$ to the rate of change of the wrist center, i.e., $\bm{J}_w
\dot{\bm{q}}_{1:4} = \dot{\bm{o}}_c$. This matrix $\bm{J}_w$ corresponds to the 
first three-by-four block of the matrix $\bm{J}_v$ from equation~\eqref{eq:jac_v}. 
%
Notice that the step size $\alpha_k$ may be orders of magnitude different
depending on whether $\bm{M} = \bm{J}_w^\top$ or $\bm{M} = \bm{J}_w^\dagger$. 


\subsection{Fully Coupled IK}
\label{ssec:ik_full}